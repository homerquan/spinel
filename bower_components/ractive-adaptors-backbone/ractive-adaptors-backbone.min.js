(function(e,t){"use strict";if(typeof module!=="undefined"&&module.exports&&typeof require==="function"){t(require("ractive"),require("backbone"))}else if(typeof define==="function"&&define.amd){define(["ractive","backbone"],t)}else if(e.Ractive&&e.Backbone){t(e.Ractive,e.Backbone)}else{throw new Error("Could not find Ractive or Backbone! Both must be loaded before the ractive-adaptors-backbone plugin")}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var n,o,i="_ractiveAdaptorsBackboneLock";if(!e||!t){throw new Error("Could not find Ractive or Backbone! Check your paths config")}function r(e){e[i]=(e[i]||0)+1;return function t(){e[i]-=1;if(!e[i]){delete e[i]}}}function a(e){return!!e[i]}e.adaptors.Backbone={filter:function(e){return e instanceof t.Model||e instanceof t.Collection},wrap:function(e,i,r,a){if(i instanceof t.Model){return new n(e,i,r,a)}return new o(e,i,r,a)}};n=function(e,t,n,o){this.value=t;t.on("change",this.modelChangeHandler=function(){var n=r(t);e.set(o(t.changed));n()})};n.prototype={teardown:function(){this.value.off("change",this.modelChangeHandler)},get:function(){return this.value.attributes},set:function(e,t){if(!a(this.value)&&e.indexOf(".")===-1){this.value.set(e,t)}},reset:function(e){if(e instanceof t.Model||!(e instanceof Object)){return false}this.value.set(e)}};o=function(e,t,n){this.value=t;t.on("add remove reset sort",this.changeHandler=function(){var o=r(t);e.set(n,t.models);o()})};o.prototype={teardown:function(){this.value.off("add remove reset sort",this.changeHandler)},get:function(){return this.value.models},reset:function(e){if(a(this.value)){return}if(e instanceof t.Collection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}}});